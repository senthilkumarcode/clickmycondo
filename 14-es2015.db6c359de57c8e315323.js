(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"G65/":function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var c=i("aSZe"),s=i("NutR"),a=i("Buwz"),n=i("dc4U"),o=i("ThaB"),r=i("wbvY"),d=i("JK/P"),l=i("F/us"),u=i("fXoL"),k=i("b6Qw"),m=i("ofXK"),h=i("668k"),b=i("BR9Y"),p=i("3Pt+"),g=i("8mtn"),f=i("tyNb");const v=["grid"];function I(t,e){1&t&&u.Xb(0,"app-loader")}function y(t,e){1&t&&(u.bc(0,"ul",4),u.bc(1,"li",5),u.Xb(2,"span",6),u.bc(3,"span"),u.Yc(4,"High"),u.ac(),u.ac(),u.bc(5,"li",5),u.Xb(6,"span",7),u.Yc(7,"Medium"),u.ac(),u.bc(8,"li",8),u.Xb(9,"span",9),u.Yc(10,"Low"),u.ac(),u.ac())}const C=function(){return{exact:!0}};function T(t,e){if(1&t){const t=u.cc();u.bc(0,"div",10),u.bc(1,"div",11),u.bc(2,"div",12),u.bc(3,"h5"),u.Yc(4,"All Tickets "),u.bc(5,"span",13),u.Yc(6),u.ac(),u.ac(),u.ac(),u.bc(7,"ul",14),u.bc(8,"li",15),u.Xb(9,"i",16),u.bc(10,"input",17),u.nc("ngModelChange",(function(e){return u.Pc(t),u.rc().ticketData=e})),u.ac(),u.ac(),u.bc(11,"li",5),u.bc(12,"a",18),u.Xb(13,"i-feather",19),u.bc(14,"span"),u.Yc(15,"Print"),u.ac(),u.ac(),u.ac(),u.bc(16,"li",5),u.bc(17,"a",20),u.Xb(18,"i-feather",21),u.bc(19,"span"),u.Yc(20,"Add Ticket"),u.ac(),u.ac(),u.ac(),u.ac(),u.ac(),u.bc(21,"div",22),u.Xb(22,"jqxGrid",23,24),u.ac(),u.ac()}if(2&t){const t=u.rc();u.Hb(6),u.Zc(t.totalItems),u.Hb(4),u.zc("ngModel",t.ticketData),u.Hb(7),u.zc("routerLinkActiveOptions",u.Fc(12,C)),u.Hb(5),u.zc("source",t.ticketListData)("theme","material")("width","100%")("autoheight",!0)("pageable",!0)("altrows",!0)("filterable",!0)("sortable",!0)("columns",t.columnsData)}}let S=(()=>{class t{constructor(t,e,i,c,s,a,n){this.injector=t,this.userService=e,this.staffService=i,this.ticketService=c,this.lookupService=s,this.sharedService=a,this.cookieService=n,this.ticketData="",this.isTicketDataLoaded=!1,this.slotData=!1,this.ticketStatusData={},this.ticketTypeData={},this.ticketPrivateCategoryData={},this.ticketCommonCategoryData={},this.ticketAssignedToData={},this.ticketPriorityData={},this.ticketType="",this.modalService=this.injector.get(d.a)}getTicketStatus(t,e){var i=l.filter(this.ticketStatusData,(function(t){if(t.lookupValueId===e)return t}));return void 0===i||0==i.length?"":(this.ticketListData.map(e=>{e.ticketId==t.ticketId&&(e.ticketStatus=i[0].lookupValueName.toLowerCase())}),i[0].lookupValueName.toLowerCase())}getTicketCategory(t){var e;return"16"==this.ticketType?void 0===(e=l.filter(this.ticketPrivateCategoryData,(function(e){if(e.lookupValueId===t)return e})))||0==e.length?"":e[0].lookupValueName:void 0===(e=l.filter(this.ticketCommonCategoryData,(function(e){if(e.lookupValueId===t)return e})))||0==e.length?"":e[0].lookupValueName}getTicketType(t,e){var i=l.filter(this.ticketTypeData,(function(t){if(t.lookupValueId===e)return t}));return void 0===i||0==i.length?"":(this.ticketListData.map(e=>{e.ticketId==t.ticketId&&(e.ticketType=i[0].lookupValueName)}),i[0].lookupValueName)}getTicketAssigned(t,e){var i=l.filter(this.assignedToData,(function(t){if(t.staffId===e)return t}));return void 0===i||0==i.length?"":(this.ticketListData.map(e=>{e.ticketId==t.ticketId&&(e.assignedToUser=i[0].firstName)}),i[0].firstName)}getTicketRequested(t,e){var i=l.filter(this.raisedByData,(function(t){if(t.userId===e)return t}));return void 0===i||0==i.length?"":(this.ticketListData.map(e=>{e.ticketId==t.ticketId&&(e.raisedByUser=i[0].firstName)}),i[0].firstName)}getTicketPriority(t,e){var i=l.filter(this.ticketPriorityData,(function(t){if(t.lookupValueId===e)return t}));return void 0===i||0==i.length?"":(this.ticketListData.map(e=>{e.ticketId==t.ticketId&&(e.ticketPriority=i[0].lookupValueName.toLowerCase())}),i[0].lookupValueName.toLowerCase())}showConfirmModal(t){this.modalService.showConfirmModal(t)}isAdmin(){return"Admin"==this.cookieService.get("userRole")||"Staff"==this.cookieService.get("userRole")}ngOnInit(){"Admin"!=this.cookieService.get("userRole")&&"Staff"!=this.cookieService.get("userRole")||this.ticketService.getAllTicketsByApartmentId(parseInt(this.cookieService.get("apartmentId"))).subscribe(t=>{var e=t.filter(t=>t.isActive);this.ticketListData=new jqx.dataAdapter({localData:e}),this.columnsData=t[0].tableColumn,this.isTicketDataLoaded=!0},t=>{}),"Tenant"!=this.cookieService.get("userRole")&&"Owner"!=this.cookieService.get("userRole")||this.ticketService.getTicketsByRaisedUserId(parseInt(this.cookieService.get("userId"))).subscribe(t=>{var e=t.filter(t=>t.isActive);this.ticketListData=new jqx.dataAdapter({localData:e}),this.columnsData=t[0].tableColumn,this.isTicketDataLoaded=!0},t=>{}),this.lookupService.getLookupValueByLookupTypeId(7).subscribe(t=>{this.ticketTypeData=t},t=>{}),this.lookupService.getLookupValueByLookupTypeId(16).subscribe(t=>{this.ticketPrivateCategoryData=t},t=>{}),this.lookupService.getLookupValueByLookupTypeId(17).subscribe(t=>{this.ticketCommonCategoryData=t},t=>{}),this.lookupService.getLookupValueByLookupTypeId(9).subscribe(t=>{this.ticketStatusData=t},t=>{}),this.lookupService.getLookupValueByLookupTypeId(14).subscribe(t=>{this.ticketPriorityData=t},t=>{}),this.staffService.getAllStaffs().subscribe(t=>{this.assignedToData=t},t=>{}),this.userService.getAllUsersByApartmentId(parseInt(this.cookieService.get("apartmentId"))).subscribe(t=>{this.raisedByData=t},t=>{}),this.sharedService.unitlistdeleteindexcast.subscribe(t=>{if(null!=t){var e={ticketId:t,deleteBy:parseInt(this.cookieService.get("userId"))};this.ticketService.deleteTicket(e).subscribe(e=>{l.each(this.ticketListData,e=>{e.ticketId==t&&(e.isActive=!1)}),setTimeout(()=>{this.ticketListData=this.ticketListData.filter(e=>e.ticketId!==t),this.totalItems=this.ticketListData.length,this.sharedService.setAlertMessage("Ticket deleted"),this.sharedService.setUnitListDeleteIndex(null)},500)},t=>{console.log(t)})}})}}return t.\u0275fac=function(e){return new(e||t)(u.Wb(u.s),u.Wb(s.a),u.Wb(a.a),u.Wb(n.a),u.Wb(o.a),u.Wb(r.a),u.Wb(k.a))},t.\u0275cmp=u.Qb({type:t,selectors:[["app-helpdesk-all-tickets"]],viewQuery:function(t,e){var i;1&t&&u.ed(v,!0),2&t&&u.Lc(i=u.oc())&&(e.grid=i.first)},decls:4,vars:3,consts:[[1,"helpdesk-all-tickets-wrapper"],[4,"ngIf"],["class","legends list-inline",4,"ngIf"],["class","card clear table-card",4,"ngIf"],[1,"legends","list-inline"],[1,"list-inline-item"],[1,"dots","high"],[1,"dots","medium"],[1,"list-inline-item","mr-0"],[1,"dots","low"],[1,"card","clear","table-card"],[1,"card-header"],[1,"float-left"],[1,"badge","lime-green"],[1,"list-inline"],[1,"list-inline-item","search","d-none","d-md-inline-block"],["aria-hidden","true",1,"fa","fa-search"],["type","text","placeholder","Search...",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","trans-white","mt_5"],["name","printer",1,"icon","print"],["routerLink","/ams/helpdesk/add-ticket","routerLinkActive","active",1,"btn","lime-green","mt_5",3,"routerLinkActiveOptions"],["name","plus",1,"icon","plus"],[1,"card-body","p-0"],[3,"source","theme","width","autoheight","pageable","altrows","filterable","sortable","columns"],["grid",""]],template:function(t,e){1&t&&(u.bc(0,"div",0),u.Wc(1,I,1,0,"app-loader",1),u.Wc(2,y,11,0,"ul",2),u.Wc(3,T,24,13,"div",3),u.ac()),2&t&&(u.Hb(1),u.zc("ngIf",!e.isTicketDataLoaded),u.Hb(1),u.zc("ngIf",e.isTicketDataLoaded),u.Hb(1),u.zc("ngIf",e.isTicketDataLoaded))},directives:[m.l,h.a,b.b,p.d,p.l,p.o,g.b,f.e,f.d,c.a],styles:[""]}),t})()},KrOI:function(t,e,i){"use strict";i.d(e,"a",(function(){return x}));var c=i("fXoL"),s=i("NutR"),a=i("dc4U"),n=i("Buwz"),o=i("ThaB"),r=i("wbvY"),d=i("F/us"),l=i("wd/R"),u=i("tyNb"),k=i("b6Qw"),m=i("ofXK"),h=i("8mtn"),b=i("3Pt+"),p=i("wlDI"),g=i("668k");function f(t,e){1&t&&(c.bc(0,"span"),c.Yc(1,"Add Ticket"),c.ac())}function v(t,e){1&t&&(c.bc(0,"span"),c.Yc(1,"Edit Ticket"),c.ac())}function I(t,e){1&t&&c.Xb(0,"app-loader")}function y(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.lookupValueId),c.Hb(1),c.Zc(t.lookupValueName)}}function C(t,e){if(1&t){const t=c.cc();c.bc(0,"div",20),c.bc(1,"div",21),c.bc(2,"label"),c.Yc(3,"Status*"),c.ac(),c.bc(4,"select",40),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc(2).ticket.ticketStatusId=e})),c.bc(5,"option",23),c.Yc(6,"Select"),c.ac(),c.Wc(7,y,2,2,"option",24),c.ac(),c.ac(),c.ac()}if(2&t){const t=c.rc(2);c.Hb(4),c.zc("ngModel",t.ticket.ticketStatusId),c.Hb(3),c.zc("ngForOf",t.statusTypeData)}}function T(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.lookupValueId),c.Hb(1),c.Zc(t.lookupValueName)}}function S(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.lookupValueId),c.Hb(1),c.Zc(t.lookupValueName)}}function M(t,e){if(1&t){const t=c.cc();c.bc(0,"div",20),c.bc(1,"div",21),c.bc(2,"label"),c.Yc(3,"Category*"),c.ac(),c.bc(4,"select",42),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc(2).ticket.ticketCategoryId=e})),c.bc(5,"option",23),c.Yc(6,"Select"),c.ac(),c.Wc(7,S,2,2,"option",24),c.ac(),c.ac(),c.ac()}if(2&t){const t=c.rc(2);c.Hb(4),c.zc("ngModel",t.ticket.ticketCategoryId),c.Hb(3),c.zc("ngForOf",t.ticketCategoryData)}}function D(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.lookupValueId),c.Hb(1),c.Zc(t.lookupValueName)}}function P(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.userId),c.Hb(1),c.Zc(t.firstName)}}function O(t,e){if(1&t&&(c.bc(0,"option",41),c.Yc(1),c.ac()),2&t){const t=e.$implicit;c.zc("value",t.staffId),c.Hb(1),c.Zc(t.firstName)}}function L(t,e){if(1&t){const t=c.cc();c.bc(0,"div",20),c.bc(1,"div",27),c.bc(2,"label"),c.Yc(3,"Assigned To*"),c.ac(),c.bc(4,"select",43),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc(2).ticket.assignedTo=e})),c.bc(5,"option",23),c.Yc(6,"Select"),c.ac(),c.Wc(7,O,2,2,"option",24),c.ac(),c.ac(),c.ac()}if(2&t){const t=c.rc(2);c.Hb(4),c.zc("ngModel",t.ticket.assignedTo),c.Hb(3),c.zc("ngForOf",t.assignedToData)}}function A(t,e){if(1&t){const t=c.cc();c.bc(0,"div"),c.bc(1,"span",45),c.Yc(2),c.ac(),c.bc(3,"span",46),c.Yc(4),c.ac(),c.bc(5,"i-feather",47),c.nc("click",(function(){c.Pc(t);const i=e.index;return c.rc(3).deleteFile(i)})),c.ac(),c.ac()}if(2&t){const t=e.$implicit,i=c.rc(3);c.Hb(2),c.Zc(t.name),c.Hb(2),c.Zc(i.bytesToSize(t.size))}}function z(t,e){if(1&t&&(c.bc(0,"div",44),c.Wc(1,A,6,2,"div",15),c.ac()),2&t){const t=c.rc(2);c.Hb(1),c.zc("ngForOf",t.listOfFiles)}}function B(t,e){if(1&t){const t=c.cc();c.Zb(0),c.bc(1,"div",18),c.Wc(2,C,8,2,"div",19),c.bc(3,"div",20),c.bc(4,"div",21),c.bc(5,"label"),c.Yc(6,"Type*"),c.ac(),c.bc(7,"select",22),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.ticketTypeId=e}))("ngModelChange",(function(){c.Pc(t);const e=c.rc();return e.getTicketType(e.ticket.ticketTypeId)})),c.bc(8,"option",23),c.Yc(9,"Select"),c.ac(),c.Wc(10,T,2,2,"option",24),c.ac(),c.ac(),c.ac(),c.Wc(11,M,8,2,"div",19),c.bc(12,"div",20),c.bc(13,"div",25),c.bc(14,"label"),c.Yc(15,"Subject*"),c.ac(),c.bc(16,"input",26),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.title=e})),c.ac(),c.ac(),c.ac(),c.bc(17,"div",20),c.bc(18,"div",27),c.bc(19,"label"),c.Yc(20,"Priorty*"),c.ac(),c.bc(21,"select",28),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.ticketPriorityId=e})),c.bc(22,"option",23),c.Yc(23,"Select"),c.ac(),c.Wc(24,D,2,2,"option",24),c.ac(),c.ac(),c.ac(),c.bc(25,"div",20),c.bc(26,"div",27),c.bc(27,"label"),c.Yc(28,"Requested By*"),c.ac(),c.bc(29,"select",29),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.raisedBy=e})),c.bc(30,"option",23),c.Yc(31,"Select"),c.ac(),c.Wc(32,P,2,2,"option",24),c.ac(),c.ac(),c.ac(),c.Wc(33,L,8,2,"div",19),c.bc(34,"div",30),c.bc(35,"div",25),c.bc(36,"label"),c.Yc(37,"Description*"),c.ac(),c.bc(38,"textarea",31),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.description=e})),c.ac(),c.ac(),c.ac(),c.bc(39,"div",30),c.bc(40,"div",25),c.bc(41,"label",32),c.nc("click",(function(){return c.Pc(t),c.Mc(43).click()})),c.bc(42,"input",33,34),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticket.file=e}))("change",(function(e){return c.Pc(t),c.rc().uploadFile(e)})),c.ac(),c.Xb(44,"i",35),c.Yc(45," Add Document"),c.ac(),c.Wc(46,z,2,1,"div",36),c.ac(),c.ac(),c.bc(47,"div",30),c.bc(48,"ul",37),c.bc(49,"li",38),c.bc(50,"button",39),c.Yc(51,"Submit"),c.ac(),c.ac(),c.ac(),c.ac(),c.ac(),c.Yb()}if(2&t){const t=c.rc(),e=c.Mc(14);c.Hb(2),c.zc("ngIf",t.isEditTicket&&t.isAdmin()),c.Hb(5),c.zc("ngModel",t.ticket.ticketTypeId),c.Hb(3),c.zc("ngForOf",t.ticketTypeData),c.Hb(1),c.zc("ngIf",t.isCategoryEnabled()),c.Hb(5),c.zc("ngModel",t.ticket.title),c.Hb(5),c.zc("ngModel",t.ticket.ticketPriorityId),c.Hb(3),c.zc("ngForOf",t.priortyTypeData),c.Hb(5),c.zc("ngModel",t.ticket.raisedBy),c.Hb(3),c.zc("ngForOf",t.raisedByData),c.Hb(1),c.zc("ngIf",t.isAdmin()&&t.isEditTicket),c.Hb(5),c.zc("ngModel",t.ticket.description),c.Hb(4),c.zc("ngModel",t.ticket.file),c.Hb(4),c.zc("ngIf",t.isFileAdded),c.Hb(4),c.zc("disabled",e.invalid)}}function w(t,e){if(1&t){const t=c.cc();c.bc(0,"div",48),c.bc(1,"div",12),c.bc(2,"form",49,50),c.nc("ngSubmit",(function(){c.Pc(t);const e=c.Mc(3);return c.rc().submitCommentForm(e)})),c.Xb(4,"app-alert-message",51),c.bc(5,"div",18),c.bc(6,"div",30),c.bc(7,"div",25),c.bc(8,"label"),c.Yc(9,"Add Comment"),c.ac(),c.bc(10,"textarea",52),c.nc("ngModelChange",(function(e){return c.Pc(t),c.rc().ticketComment=e})),c.ac(),c.ac(),c.bc(11,"button",53),c.Yc(12,"Submit"),c.ac(),c.ac(),c.ac(),c.ac(),c.ac(),c.ac()}if(2&t){const t=c.Mc(3),e=c.rc();c.Hb(4),c.zc("message",e.alertCommentMessage)("isError",e.isCommentError)("isSuccess",e.isCommentSuccess),c.Hb(6),c.zc("ngModel",e.ticketComment),c.Hb(1),c.zc("disabled",t.invalid)}}function H(t,e){1&t&&c.Xb(0,"app-loader")}function Y(t,e){if(1&t){const t=c.cc();c.bc(0,"span",67),c.nc("click",(function(){c.Pc(t);const e=c.rc(2),i=e.$implicit,s=e.index;return c.rc().deleteTicketComment(i.ticketCommentId,s)})),c.Xb(1,"i-feather",68),c.ac()}}function _(t,e){if(1&t&&(c.bc(0,"div",55),c.bc(1,"div",12),c.bc(2,"li",56),c.bc(3,"div",57),c.bc(4,"div",58),c.Xb(5,"img",59),c.ac(),c.bc(6,"div",60),c.bc(7,"div"),c.bc(8,"h5",61),c.Yc(9),c.ac(),c.bc(10,"span",62),c.Yc(11),c.ac(),c.bc(12,"div",63),c.Wc(13,Y,2,0,"span",64),c.ac(),c.ac(),c.bc(14,"p",65),c.Yc(15),c.ac(),c.bc(16,"p",66),c.Yc(17),c.ac(),c.ac(),c.ac(),c.ac(),c.ac(),c.ac()),2&t){const t=c.rc().$implicit,e=c.rc();c.Hb(9),c.Zc(t.userName),c.Hb(2),c.Zc(e.getCommentDate(t.insertedOn)),c.Hb(2),c.zc("ngIf",e.isLoggedUser(t.userId)),c.Hb(2),c.Zc(t.roleName),c.Hb(2),c.Zc(t.comments)}}function F(t,e){if(1&t&&(c.Zb(0),c.Wc(1,_,18,5,"div",54),c.Yb()),2&t){const t=c.rc();c.Hb(1),c.zc("ngIf",t.isTicketCommentLoaded)}}function W(t,e){1&t&&(c.bc(0,"div",69),c.bc(1,"li",70),c.bc(2,"div",57),c.bc(3,"div",60),c.bc(4,"h5"),c.Yc(5,"No Comments Available"),c.ac(),c.ac(),c.ac(),c.ac(),c.ac())}const N=function(){return{exact:!0}};let x=(()=>{class t{constructor(t,e,i,s,a,n,o,r){this.router=t,this.route=e,this.userService=i,this.ticketService=s,this.staffService=a,this.lookupService=n,this.sharedService=o,this.cookieService=r,this.isEditTicket=!1,this.isTicketSubmitted=!1,this.isTicketAdded=!1,this.isError=!1,this.alertMessage="",this.isCommentError=!1,this.isCommentSuccess=!1,this.alertCommentMessage="",this.isTypeSelected=!1,this.documentName="",this.fileList=[],this.listOfFiles=[],this.isFileAdded=!1,this.isTicketCommentLoaded=!1,this.ticketComment="",this.outputParams=new c.o}isArrayOne(){return this.ticketArray.length>1}deleteTicket(){this.ticketArray.splice(this.index,1),this.outputParams.emit(this.ticketArray)}isAdmin(){return"Admin"==this.cookieService.get("userRole")||"Staff"==this.cookieService.get("userRole")}isCategoryEnabled(){return!!this.isEditTicket||!!this.isTypeSelected}getTicketType(t){this.isTypeSelected=!0,"26"==t?this.lookupService.getLookupValueByLookupTypeId(17).subscribe(t=>{this.ticketCategoryData=t.filter(t=>t.isActive)},t=>{}):this.lookupService.getLookupValueByLookupTypeId(16).subscribe(t=>{this.ticketCategoryData=t.filter(t=>t.isActive)},t=>{})}uploadFile(t){this.isFileAdded=!0;for(var e=0;e<=t.target.files.length-1;e++){var i=t.target.files[e];this.fileList.push(i),this.listOfFiles.push({name:i.name,size:i.size})}}deleteFile(t){this.listOfFiles.splice(t,1),this.fileList.splice(t,1),this.selectedFile=null,0==this.fileList.length&&0==this.listOfFiles.length&&(this.isFileAdded=!1)}bytesToSize(t){return t<1024?t+" Bytes":t<1048576?(t/1024).toFixed(3)+" KB":t<1073741824?(t/1048576).toFixed(3)+" MB":(t/1073741824).toFixed(3)+" GB"}getCommentDate(t){return l(t).fromNow()}isNoComments(){return 0==this.ticketCommentsData.length}editTicketAgain(){this.isTicketSubmitted=!1}confirmDialoque(t){confirm("Do you want to Submit the ticket? ")&&this.submitTicketForm(t)}submitTicketForm(t){if(this.isTicketSubmitted=!0,this.isError=!1,this.isEditTicket){let t={ticketId:parseInt(this.route.params.value.id),apartmentId:parseInt(this.cookieService.get("apartmentId")),ticketTypeId:parseInt(this.ticket.ticketTypeId),title:this.ticket.title,description:this.ticket.description,raisedBy:parseInt(this.ticket.raisedBy),ticketStatusId:parseInt(this.ticket.ticketStatusId),ticketCategoryId:parseInt(this.ticket.ticketCategoryId),assignedTo:parseInt(this.ticket.assignedTo),ticketPriorityId:parseInt(this.ticket.ticketPriorityId),isActive:this.ticket.isActive,insertedBy:this.ticket.insertedBy,insertedOn:this.ticket.insertedOn,updatedBy:parseInt(this.cookieService.get("userId")),updatedOn:(new Date).toISOString()};this.ticketService.updateTicket(t).subscribe(t=>{this.isTicketSubmitted=!1,t.message?this.sharedService.setAlertMessage("Ticket Updated successfully"):(this.isError=!0,this.alertMessage=t.alertTicketMessage)},t=>{})}else{let t={apartmentId:parseInt(this.cookieService.get("apartmentId")),ticketTypeId:parseInt(this.ticket.ticketTypeId),title:this.ticket.title,description:this.ticket.description,raisedBy:parseInt(this.ticket.raisedBy),ticketStatusId:parseInt(this.ticket.ticketStatusId),ticketCategoryId:parseInt(this.ticket.ticketCategoryId),assignedTo:parseInt(this.ticket.assignedTo),ticketPriorityId:parseInt(this.ticket.ticketPriorityId),isActive:!0,insertedBy:parseInt(this.cookieService.get("userId")),insertedOn:"2019-11-11T14:50:55.782Z",updatedBy:0,updatedOn:"2019-11-11T14:50:55.782Z"};this.ticketService.addTicket(t).subscribe(t=>{this.isTicketSubmitted=!1,t.message?(this.sharedService.setAlertMessage("Ticket added successfully"),this.isTicketAdded=!0,this.ticketId=t.message,setTimeout(()=>{this.router.navigate(["/ams/helpdesk/all-tickets"])},2e3)):(this.isError=!0,this.alertMessage=t.alertTicketMessage)},t=>{})}}deleteTicketComment(t,e){this.isTicketCommentLoaded=!1;var i={ticketCommentId:t,deleteBy:parseInt(this.cookieService.get("userId"))};this.ticketService.deleteTicketComment(i).subscribe(t=>{this.ticketCommentsData.splice(e,1),this.isTicketCommentLoaded=!0},t=>{})}submitCommentForm(t){var e=new Date;let i={ticketId:this.ticketId,comments:this.ticketComment,isActive:!0,insertedBy:parseInt(this.cookieService.get("userId")),insertedOn:e.toISOString(),updatedBy:parseInt(this.cookieService.get("userId")),updatedOn:e.toISOString()};this.ticketService.addTicketComment(i).subscribe(t=>{t.message?(this.isCommentSuccess=!0,this.alertCommentMessage="Comment added successfully",this.isTicketCommentLoaded=!1,this.ticketService.getAllTicketCommentsByTicketId(this.ticketId).subscribe(t=>{this.isTicketCommentLoaded=!0,this.ticketCommentsData=t.filter(t=>t.isActive),d.each(this.ticketCommentsData,(t,e)=>{this.userService.getUserById(this.ticketCommentsData[e].insertedBy).subscribe(t=>{this.ticketCommentsData[e].userName=t[0].firstName+" "+t[0].lastName,this.ticketCommentsData[e].userId=t[0].userId})})})):(this.isCommentError=!0,this.alertCommentMessage=t.message)},t=>{})}isLoggedUser(t){return t==parseInt(this.cookieService.get("userId"))}ngOnInit(){console.log(this.ticketArray),this.ticket={},this.ticket.ticketCategoryId="",this.ticket.ticketTypeId="",this.ticket.ticketPriorityId="",this.ticket.ticketStatusId="32",this.ticket.raisedBy="",this.ticket.assignedTo="",this.ticketArray=[],this.ticketCommentsData=[],null!=this.route.params.value.id?(this.isEditTicket=!0,this.isTicketAdded=!0,this.ticketId=this.route.params.value.id,this.ticketService.getTicketById(this.route.params.value.id).subscribe(t=>{this.ticket=t[0],this.getTicketType(this.ticket.ticketTypeId),console.log(this.ticket)},t=>{}),this.ticketService.getAllTicketCommentsByTicketId(this.route.params.value.id).subscribe(t=>{this.isTicketCommentLoaded=!0,this.ticketCommentsData=t.filter(t=>t.isActive),d.each(this.ticketCommentsData,(t,e)=>{this.userService.getUserById(this.ticketCommentsData[e].insertedBy).subscribe(t=>{this.ticketCommentsData[e].userName=t[0].firstName+" "+t[0].lastName,this.ticketCommentsData[e].userId=t[0].userId},t=>{this.isTicketCommentLoaded=!0}),this.userService.getRolesByUserId(this.ticketCommentsData[e].insertedBy).subscribe(t=>{this.ticketCommentsData[e].roleName=void 0===t||0==t.length?"-":t[0].roleName},t=>{})})})):(this.isTicketCommentLoaded=!0,this.ticketCommentsData=[]),this.lookupService.getLookupValueByLookupTypeId(7).subscribe(t=>{this.ticketTypeData=t.filter(t=>t.isActive)},t=>{}),this.lookupService.getLookupValueByLookupTypeId(16).subscribe(t=>{this.ticketCategoryData=t.filter(t=>t.isActive)},t=>{}),this.lookupService.getLookupValueByLookupTypeId(14).subscribe(t=>{this.priortyTypeData=t.filter(t=>t.isActive)},t=>{}),this.lookupService.getLookupValueByLookupTypeId(9).subscribe(t=>{this.statusTypeData=t.filter(t=>t.isActive)},t=>{}),this.userService.getAllUsersByApartmentId(parseInt(this.cookieService.get("apartmentId"))).subscribe(t=>{this.raisedByData=t,"Tenant"!=this.cookieService.get("userRole")&&"Owner"!=this.cookieService.get("userRole")||(this.raisedByData=t.filter(t=>t.userId==parseInt(this.cookieService.get("userId"))),this.ticket.raisedBy=this.raisedByData[0].userId)},t=>{}),this.staffService.getAllStaffs().subscribe(t=>{this.assignedToData=t},t=>{})}}return t.\u0275fac=function(e){return new(e||t)(c.Wb(u.c),c.Wb(u.a),c.Wb(s.a),c.Wb(a.a),c.Wb(n.a),c.Wb(o.a),c.Wb(r.a),c.Wb(k.a))},t.\u0275cmp=c.Qb({type:t,selectors:[["app-add-ticket"]],inputs:{index:"index",ticketArray:["array","ticketArray"]},outputs:{outputParams:"outputParams"},decls:24,vars:12,consts:[[1,"helpdesk-add-ticket-wrapper"],[1,"float-left","mt-4"],[4,"ngIf"],[1,"relative-card","float-right"],[1,"relative-icon"],["href","javascript:void(0)","routerLink","/ams/helpdesk/all-tickets","routerLinkActive","active",3,"routerLinkActiveOptions"],[1,"icon-wrapper"],["name","chevron-left",1,"icon","back"],[1,"d-inline-block"],[1,"card","clear","mb-30"],["name","addTicketForm","novalidate","",3,"ngSubmit"],["addTicketForm","ngForm"],[1,"card-body"],[3,"message","isAlert"],["class","card mb-20",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"card"],["class","card-body comments",4,"ngIf"],[1,"row"],["class","col-sm-4",4,"ngIf"],[1,"col-sm-4"],[1,"select-box"],["name","ticketCategory","id","ticketCategory","required","",1,"form-control",3,"ngModel","ngModelChange"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],[1,"input-box"],["type","text","placeholder","Enter text","name","ticketSubject","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-box","select-box"],["name","priortyType","id","priortyType","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","raisedBy","id","raisedBy","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-sm-12"],["placeholder","Enter value","name","ticketDescription","required","",3,"ngModel","ngModelChange"],["for","my-file-selector",1,"btn","sf","lime-green",3,"click"],["id","uploader","name","uploader","type","file","multiple","",1,"form-control",3,"ngModel","ngModelChange","change"],["uploader",""],["aria-hidden","true",1,"fa","fa-paperclip","mr-2"],["class","file-desp",4,"ngIf"],[1,"list-inline","float-right","mt-4"],[1,"list-inline-item"],[1,"btn","blue","mr-2",3,"disabled"],["name","ticketStatus","id","ticketStatus","required","",1,"form-control",3,"ngModel","ngModelChange"],[3,"value"],["name","ticketType","id","ticketType","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","assignedTo","id","assignedTo","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"file-desp"],[1,"name","mr-3"],[1,"size"],["name","x",1,"icon","del",3,"click"],[1,"card","mb-20"],["name","addCommentForm","novalidate","",3,"ngSubmit"],["addCommentForm","ngForm"],[3,"message","isError","isSuccess"],["placeholder","some text here","name","ticketComment","required","",3,"ngModel","ngModelChange"],[1,"btn","blue","float-right",3,"disabled"],["class","card mt-3 comments",4,"ngIf"],[1,"card","mt-3","comments"],[1,"list-group-item"],[1,"media"],[1,"icon","mr-3"],["src","assets/images/user-icon.svg","width","28"],[1,"media-body"],[1,"mt-0"],[1,"ml-3","date"],[1,"float-right","menus"],[3,"click",4,"ngIf"],[1,"role"],[1,"desp"],[3,"click"],["name","x",1,"icon","del"],[1,"card-body","comments"],[1,"list-group-item","no-comments","no-border"]],template:function(t,e){if(1&t){const t=c.cc();c.bc(0,"div",0),c.bc(1,"div",1),c.bc(2,"h5"),c.Wc(3,f,2,0,"span",2),c.Wc(4,v,2,0,"span",2),c.ac(),c.ac(),c.bc(5,"div",3),c.bc(6,"div",4),c.bc(7,"a",5),c.bc(8,"div",6),c.Xb(9,"i-feather",7),c.ac(),c.bc(10,"span",8),c.Yc(11,"All Tickets"),c.ac(),c.ac(),c.ac(),c.ac(),c.bc(12,"div",9),c.bc(13,"form",10,11),c.nc("ngSubmit",(function(){c.Pc(t);const i=c.Mc(14);return e.confirmDialoque(i)})),c.bc(15,"div",12),c.Xb(16,"app-alert-message",13),c.Wc(17,I,1,0,"app-loader",2),c.Wc(18,B,52,14,"ng-container",2),c.ac(),c.ac(),c.ac(),c.Wc(19,w,13,5,"div",14),c.Wc(20,H,1,0,"app-loader",2),c.Wc(21,F,2,1,"ng-container",15),c.bc(22,"div",16),c.Wc(23,W,6,0,"div",17),c.ac(),c.ac()}2&t&&(c.Hb(3),c.zc("ngIf",!e.isEditTicket),c.Hb(1),c.zc("ngIf",e.isEditTicket),c.Hb(3),c.zc("routerLinkActiveOptions",c.Fc(11,N)),c.Hb(9),c.zc("message",e.alertMessage)("isAlert",e.isError),c.Hb(1),c.zc("ngIf",e.isTicketSubmitted),c.Hb(1),c.zc("ngIf",!e.isTicketSubmitted),c.Hb(1),c.zc("ngIf",e.isTicketAdded),c.Hb(1),c.zc("ngIf",!e.isTicketCommentLoaded),c.Hb(1),c.zc("ngForOf",e.ticketCommentsData),c.Hb(2),c.zc("ngIf",e.isNoComments()&&e.isEditTicket))},directives:[m.l,u.e,u.d,h.b,b.z,b.m,b.n,p.a,m.k,g.a,b.w,b.v,b.l,b.o,b.p,b.y,b.d],styles:[".helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0;border:none;background-color:transparent}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:relative;z-index:100}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{float:left;color:#373946;margin:0 0 6px}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Lato,sans-serif;font-weight:400;letter-spacing:.3px;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;font-size:1.4rem;color:#8391a1;cursor:pointer}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:14px}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   .icon.del[_ngcontent-%COMP%]{width:16px}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{color:#373946;transition:all .15s ease}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .media[_ngcontent-%COMP%]   p.role[_ngcontent-%COMP%]{background-color:#5cd694;float:left;display:block;padding:0 12px!important;border-radius:18px!important;color:#fff}.helpdesk-add-ticket-wrapper[_ngcontent-%COMP%]   .card.comments[_ngcontent-%COMP%]   li.no-comments[_ngcontent-%COMP%]:before{content:none}"]}),t})()}}]);